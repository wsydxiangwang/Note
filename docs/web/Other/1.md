# toString & valueOf

åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰JSæ•°æ®ç±»å‹éƒ½æ‹¥æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œnullé™¤å¤–ã€‚å®ƒä»¬ä¿©æ˜¯ä½äºåŸå‹é“¾ä¸Šçš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ä¸ºäº†è§£å†³javascriptå€¼è¿ç®—ä¸æ˜¾ç¤ºçš„é—®é¢˜ã€‚

`valueOf` å’Œ `toString` å‡ ä¹éƒ½æ˜¯åœ¨å‡ºç°æ“ä½œç¬¦`(+-*/==><)`æ—¶è¢«è°ƒç”¨ï¼ˆéšå¼è½¬æ¢ï¼‰ã€‚

## toString

> è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå½“å¯¹è±¡è¡¨ç¤ºä¸ºæ–‡æœ¬å€¼æˆ–ä»¥æœŸæœ›çš„å­—ç¬¦ä¸²æ–¹å¼è¢«å¼•ç”¨æ—¶ï¼ŒtoStringæ–¹æ³•è¢«è‡ªåŠ¨è°ƒç”¨ã€‚


1. æ‰‹åŠ¨è°ƒç”¨çœ‹çœ‹ä»€ä¹ˆæ•ˆæœ

å—¯ï¼Œè·Ÿä»‹ç»çš„ä¸€æ ·ï¼Œæ²¡éª—äººï¼Œå…¨éƒ¨éƒ½è½¬æˆäº†å­—ç¬¦ä¸²ã€‚

```js
let a = {}
let b = [1, 2, 3]
let c = '123'
let d = function(){ console.log('fn') }

console.log(a.toString())   // '[object Object]'
console.log(b.toString())   // '1,2,3'
console.log(c.toString())   // '123'
console.log(d.toString())   // 'function(){ console.log('fn') }'
```

2. åˆ¤æ–­ç±»å‹

è¿™ç§å±äºæ›´ç²¾ç¡®çš„åˆ¤æ–­æ–¹å¼ï¼Œåœ¨æŸç§åœºåˆä¼šæ¯”ä½¿ç”¨ `typeof` & `instanceof` æ¥çš„æ›´é«˜æ•ˆå’Œå‡†ç¡®äº›ã€‚

```js
toString.call(()=>{})       // [object Function]
toString.call({})           // [object Object]
toString.call([])           // [object Array]
toString.call('')           // [object String]
toString.call(22)           // [object Number]
toString.call(undefined)    // [object undefined]
toString.call(null)         // [object null]
toString.call(new Date)     // [object Date]
toString.call(Math)         // [object Math]
toString.call(window)       // [object Window]
```

3. è‡ªåŠ¨è°ƒç”¨

ä½¿ç”¨æ“ä½œç¬¦çš„æ—¶å€™ï¼Œå¦‚æœå…¶ä¸­ä¸€è¾¹ä¸ºå¯¹è±¡ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨`toSting`æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯`éšå¼ç±»å‹è½¬æ¢`ï¼Œç„¶åå†è¿›è¡Œæ“ä½œã€‚

```js
let c = [1, 2, 3]
let d = {a:2}
Object.prototype.toString = function(){
    console.log('Object')
}
Array.prototype.toString = function(){
    console.log('Array')
}
Number.prototype.toString = function(){
    console.log('Number')
}
String.prototype.toString = function(){
    console.log('String')
}
console.log(2 + 1)  // 3
console.log('s')    // 's'
console.log('s'+2)  // 's2'
console.log(c < 2)  // false        (ä¸€æ¬¡ => 'Array')
console.log(c + c)  // "1,2,31,2,3" (ä¸¤æ¬¡ => 'Array')
console.log(d > d)  // false        (ä¸¤æ¬¡ => 'Object')
```

4. é‡å†™`toString`æ–¹æ³•

```js
class A {
    constructor(count) {
        this.count = count
    }
    toString() {
        return 'æˆ‘æœ‰è¿™ä¹ˆå¤šé’±ï¼š' + this.count
    }
}
let a = new A(100)

console.log(a)              // AÂ {count: 100}
console.log(a.toString())   // æˆ‘æœ‰è¿™ä¹ˆå¤šé’±ï¼š100
console.log(a + 1)          // æˆ‘æœ‰è¿™ä¹ˆå¤šé’±ï¼š1001
```

## valueOf

> è¿”å›å½“å‰å¯¹è±¡çš„åŸå§‹å€¼ã€‚

å…·ä½“åŠŸèƒ½ä¸`toString`å¤§åŒå°å¼‚ï¼ŒåŒæ ·å…·æœ‰ä»¥ä¸Šçš„è‡ªåŠ¨è°ƒç”¨å’Œé‡å†™æ–¹æ³•ã€‚

è¿™é‡Œå°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œä¸»è¦ä¸ºä¸¤è€…é—´çš„åŒºåˆ«ï¼Œæœ‰è¯·å¾€ä¸‹çœ‹ğŸ™ŠğŸ™Š

```js
let c = [1, 2, 3]
let d = {a:2}

console.log(c.valueOf())    // [1, 2, 3]
console.log(d.valueOf())    // {a:2}
```

## ä¸¤è€…åŒºåˆ«

- å…±åŒç‚¹ï¼šåœ¨è¾“å‡ºå¯¹è±¡æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚
- ä¸åŒç‚¹ï¼šå­˜åœ¨ä¼˜å…ˆçº§å…³ç³»ã€‚

äºŒè€…å¹¶å­˜çš„æƒ…å†µä¸‹ï¼Œåœ¨**æ•°å€¼**è¿ç®—ä¸­ï¼Œä¼˜å…ˆè°ƒç”¨äº†`valueOf`ï¼Œ**å­—ç¬¦ä¸²**è¿ç®—ä¸­ï¼Œä¼˜å…ˆè°ƒç”¨äº†`toString`ã€‚

çœ‹ä»£ç æ–¹å¯çŸ¥æ™“ï¼š

```js
class A {
    valueOf() {
        return 2
    }
    toString() {
        return 'å“ˆå“ˆå“ˆ'
    }
}
let a = new A()

console.log(String(a))  // 'å“ˆå“ˆå“ˆ'   => (toString)
console.log(Number(a))  // 2         => (valueOf)
console.log(a + '22')   // '222'     => (valueOf)
console.log(a == 2)     // true      => (valueOf)
console.log(a === 2)    // false
```

ç»“æœç»™äººçš„æ„Ÿè§‰æ˜¯ï¼Œå¦‚æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶è°ƒç”¨toStringæ–¹æ³•ï¼Œå¦‚æœæ˜¯è½¬æ¢ä¸ºæ•°å€¼æ—¶åˆ™è°ƒç”¨valueOfæ–¹æ³•ï¼Œä½†å…¶ä¸­æœ‰ä¸¤ä¸ªå¾ˆä¸å’Œè°ã€‚ä¸€ä¸ªæ˜¯alert(''+bbb)ï¼Œå­—ç¬¦ä¸²åˆæ‹¼åº”è¯¥æ˜¯è°ƒç”¨toStringæ–¹æ³•â€¦â€¦å¦ä¸€ä¸ªæˆ‘ä»¬æš‚æ—¶å¯ä»¥ç†è§£ä¸º===æ“ä½œç¬¦ä¸è¿›è¡Œéšå¼è½¬æ¢ï¼Œå› æ­¤ä¸è°ƒç”¨å®ƒä»¬ã€‚ä¸ºäº†è¿½ç©¶çœŸç›¸ï¼Œæˆ‘ä»¬éœ€è¦æ›´ä¸¥è°¨çš„å®éªŒã€‚


## é¢è¯•é¢˜

1. [å¤§å‚é¢è¯•é¢˜åˆ†äº«ï¼šå¦‚ä½•è®©(a===1&&a===2&&a===3)çš„å€¼ä¸ºtrue?](https://juejin.im/post/6844904085930377229)

æ¥è‡ªè…¾è®¯å¤§ä½¬çš„åˆ†äº«ï¼Œå€Ÿä»¥å­¦ä¹ 

åŒç­‰å·(==)ï¼šä¼šè§¦å‘`éšå¼ç±»å‹è½¬æ¢`ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ `valueOf` æˆ–è€… `toString` æ¥å®ç°ã€‚

```js
class A {
    constructor(value) {
        this.value = value;
    }
    valueOf() {
        return this.value++;
    }
}
const a = new A(1);
if (a == 1 && a == 2 && a == 3) {
    console.log("Hi Libai!");
}
```

å…¨ç­‰(===)ï¼šä¸¥æ ¼ç­‰äºä¸ä¼šè¿›è¡Œ`éšå¼è½¬æ¢`ï¼Œè¿™é‡Œä½¿ç”¨ `Object.defineProperty` æ•°æ®åŠ«æŒçš„æ–¹æ³•æ¥å®ç°

```js
let value = 1;
Object.defineProperty(window, 'a', {
    get() {
        return value++
    }
})
if (a === 1 && a === 2 && a === 3) {
    console.log("Hi Libai!")
}
```

ä¸Šé¢æˆ‘ä»¬å°±æ˜¯åŠ«æŒå…¨å±€`window`ä¸Šé¢çš„`a`ï¼Œå½“`a`æ¯ä¸€æ¬¡åšåˆ¤æ–­çš„æ—¶å€™éƒ½ä¼šè§¦å‘`get`å±æ€§è·å–å€¼ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡è·å–å€¼éƒ½ä¼šè§¦å‘ä¸€æ¬¡å‡½æ•°å®è¡Œä¸€æ¬¡è‡ªå¢ï¼Œåˆ¤æ–­ä¸‰æ¬¡å°±è‡ªå¢ä¸‰æ¬¡ï¼Œæ‰€ä»¥æœ€åä¼šè®©å…¬å¼æˆç«‹ã€‚

æ³¨ï¼š`defineProperty` å¯å‚è€ƒè¿™ç¯‡æ–‡ç« å­¦ä¹ ï¼Œ[ç‚¹æˆ‘è¿›å…¥ä¼ é€é—¨](https://github.com/wsydxiangwang/Note/blob/master/docs/web/Object/5.md)

2. 